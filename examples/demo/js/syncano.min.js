/*
syncano
ver: 3.1.2beta
build date: 24-06-2014
Copyright 2014 Syncano Inc.
*/
!function(a,b){"use strict";function c(a){var b={},c="Boolean Number String Function Array Date RegExp Object".split(" ");for(var d in c)b["[object "+c[d]+"]"]=c[d].toLowerCase();return null===a?String(a):b[Object.prototype.toString.call(a)]||"object"}function d(a){return"function"===c(a)}function e(a){return null!==a&&a==a.window}function f(a){var d=Object.prototype.hasOwnProperty;if(!a||"object"!==c(a)||a.nodeType||e(a))return!1;try{if(a.constructor&&!d.call(a,"constructor")&&!d.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(f){return!1}var g;for(g in a);return g===b||d.call(a,g)}function g(a){return"array"===c(a)}function h(){var a,c,e,i,j,k,l=arguments[0]||{},m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),"object"==typeof l||d(l)||(l={});n>m;m++)if(null!==(a=arguments[m]))for(c in a)e=l[c],i=a[c],l!==i&&(o&&i&&(f(i)||(j=g(i)))?(j?(j=!1,k=e&&g(e)?e:[]):k=e&&f(e)?e:{},l[c]=h(o,k,i)):i!==b&&(l[c]=i));return l}function i(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];a.charCodeAt(c)>=97?b.push(e):(b.push("_"),b.push(e.toLowerCase()))}return b.join("")}function j(a){return"undefined"!=typeof a&&null!==a}function k(a){return"number"==typeof a||parseInt(a,10)==a?!0:!1}function l(a){var b=new Date(a);return"[object Date]"!==Object.prototype.toString.call(b)?!1:!isNaN(b.getTime())}function m(a,b){return-1!==b.indexOf(a)?!0:!1}function n(a){return"boolean"==typeof a}var o={},p={},q=0;o.on=function(a,b){if("function"!=typeof b)return!1;p.hasOwnProperty(a)||(p[a]={});var c="uid_"+ ++q;return p[a][c]=b,c},o.once=function(a,b){if("function"!=typeof b)return!1;p.hasOwnProperty(a)||(p[a]={});var c="uid_"+ ++q;return p[a][c]=function(d){delete p[a][c],b(d)},c},o.hasSubscribers=function(a){return"string"!=typeof a?!1:p.hasOwnProperty(a)&&Object.keys(p[a]).length?!0:!1},o.off=function(a,b){if("all"===a&&(p={}),!this.hasSubscribers(a))return!1;if("undefined"==typeof b)return delete p[a];var c=p[a];for(var d in c)if(c.hasOwnProperty(d)&&b===c[d])return delete p[a][d];return!1},o.trigger=function(a){return o.doTrigger(a,!1,Array.prototype.slice.call(arguments,1))},o.triggerSync=function(a){return o.doTrigger(a,!0,Array.prototype.slice.call(arguments,1))},o.doTrigger=function(a,b){var c,d,e,f=!1,g=Array.prototype.slice.call(arguments,2)[0];if(this.hasSubscribers(a)){c=p[a];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,g),0):e.call(e,g),f=!0)}var h="all";if(this.hasSubscribers(h)){c=p[h];for(d in c)c.hasOwnProperty(d)&&(e=c[d],b===!1?setTimeout(e.call(e,a,g),0):e.call(e,a,g),f=!0)}return f};var r={};r.new=function(a,b,c){var d="project.new";if(!j(a))throw new Error(d+": name must be defined");var e={name:a};j(b)&&(e.description=b),this.__super__.__sendWithCallback(d,e,"project",c)},r.get=function(a){var b="project.get";this.__super__.__sendWithCallback(b,{},"project",a)},r.getOne=function(a,b){this.__super__.__checkProjectId(a);var c="project.get_one";this.__super__.__sendWithCallback(c,{project_id:a},"project",b)},r.update=function(a,b,c,d){if(this.__super__.__checkProjectId(a),!("undefined"!=typeof b&&null!==b||"undefined"!=typeof c&&null!==b))return!1;var e="project.update",f={project_id:a};b&&(f.name=b),"undefined"!=typeof c&&null!==c&&(f.description=c),this.__super__.__sendWithCallback(e,f,"project",d)},r.delete=function(a,b){this.__super__.__checkProjectId(a);var c="project.delete";this.__super__.__sendWithCallback(c,{project_id:a},null,b)};var s={};s.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.new";if(!j(b))throw new Error(e+": name must be set");var f={name:b,project_id:a};j(c)&&(j(c.description)&&(f.description=c.description),j(c.key)&&(f.key=c.key)),this.__super__.__sendWithCallback(e,f,"collection",d)},s.get=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.get",e={project_id:a};if(j(b)){if(j(b.status)){if(!m(b.status.toLowerCase(),["all","active","inactive"]))throw new Error(d+': status must be one of the values: "active", "inactive", "all"');e.status=b.status}j(b.withTags)&&(e.with_tags=b.withTags)}this.__super__.__sendWithCallback(d,e,"collection",c)},s.getOne=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.get_one",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"collection",c)},s.activate=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.activate";if(!k(b))throw new Error(e+": collectionId must be a number");var f={project_id:a,collection_id:b};j(c)&&(f.force=c),this.__super__.__sendWithCallback(e,f,null,d)},s.deactivate=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.deactivate",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},s.update=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.update",f={project_id:a};f=this.__super__.__addCollectionIdentifier(f,b),j(c)&&(j(c.name)&&(f.name=c.name),j(c.description)&&(f.description=c.description)),this.__super__.__sendWithCallback(e,f,"collection",d)},s.addTag=function(a,c,d,e,f){"function"==typeof arguments[3]&&(f=arguments[3],e=b),this.__super__.__checkProjectId(a);var g="collection.add_tag",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,c),"string"!=typeof d&&("object"!=typeof d||"undefined"==typeof d.length))throw new Error(g+": tags must be passed");var i;if(i="string"==typeof d?d:d.join(","),!/^[\000-\177]*$/.test(i))throw new Error(g+": non ascii characters found in tag name");h.tags=d,j(e)&&(j(e.weight)&&(h.weight=e.weight),j(e.removeOther)&&(h.remove_other=!!e.removeOther)),this.__super__.__sendWithCallback(g,h,null,f)},s.deleteTag=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="collection.delete_tag",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c&&("object"!=typeof c||"undefined"==typeof c.length))throw new Error(e+": tags must be passed");var g;if(g="string"==typeof c?c:c.join(","),!/^[\000-\177]*$/.test(g))throw new Error(e+": non ascii characters found in tag name");f.tags=c,this.__super__.__sendWithCallback(e,f,null,d)},s.authorize=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.authorize",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!k(c))throw new Error(f+": apiClientId must be a number");var h=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(-1===h.indexOf(d))throw new Error(f+": unknown permission name ("+d+")");g.api_client_id=c,g.permission=d,this.__super__.__sendWithCallback(f,g,null,e)},s.deauthorize=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="collection.deauthorize",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!k(c))throw new Error(f+": apiClientId must be a number");var h=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(-1===h.indexOf(d))throw new Error(f+": unknown permission name ("+d+")");g.api_client_id=c,g.permission=d,this.__super__.__sendWithCallback(f,g,null,e)},s.delete=function(a,b,c){this.__super__.__checkProjectId(a);var d="collection.delete",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)};var t={};t.new=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.new",f={name:c,project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),!c)throw new Error("Folder must have a name");this.__super__.__sendWithCallback(e,f,"folder",d)},t.get=function(a,b,c){this.__super__.__checkProjectId(a);var d="folder.get",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,"folder",c)},t.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.folder_name=c,this.__super__.__sendWithCallback(e,f,"folder",d)},t.update=function(a,b,c,d,e,f){if("object"==typeof arguments[3]){var g=Object.create(arguments[3]);f=arguments[4],d=g.newName,e=g.sourceId}this.__super__.__checkProjectId(a);var h="folder.update",i={project_id:a};if(i=this.__super__.__addCollectionIdentifier(i,b),"string"!=typeof c)throw new Error("FolderName must be a string");if(i.name=c,!j(d))throw new Error("newName must be passed");if("string"!=typeof d)throw new Error("newName must be a string");if(i.new_name=d,j(e)){if(!k(e))throw new Error("sourceId must be a number");i.source_id=e+""}this.__super__.__sendWithCallback(h,i,"folder",f)},t.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="folder.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"!=typeof c)throw new Error("FolderName must be a string");f.name=c,this.__super__.__sendWithCallback(e,f,null,d)},t.authorize=function(a,b,c,d,e,f){this.__super__.__checkProjectId(b);var g="folder.authorize",h={project_id:b};if(h=this.__super__.__addCollectionIdentifier(h,c),h.api_client_id=a,"string"!=typeof e)throw new Error("FolderName must be a string");h.name=e;var i=["create_data","read_data","read_own_data","update_data","update_own_data","delete_data","delete_own_data"];if(!j(d)||-1===i.indexOf(d))throw new Error("Permission must be one of: "+i.join(", "));h.permission=d,this.__super__.__sendWithCallback(g,h,null,f)};var u={};u.new=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.new",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),j(c)){for(var h=["dataKey","userName","sourceUrl","title","text","link","image","imageUrl","folder","state"],l=0;l<h.length;l++){var m=h[l];if(j(c[m])){if("string"!=typeof c[m])throw new Error(m+" must be a string");g[i(m)]=c[m]}}if(j(c.parentId)){if(!k(c.parentId))throw new Error("parentId must be a number");g.parent_id=c.parentId}if(j(g.state)&&-1==["pending","moderated","rejected"].indexOf(g.state.toLowerCase()))throw new Error("incorrect value of state param");if(j(c.additional))for(var n in c.additional)if(c.additional.hasOwnProperty(n)){var o=c.additional[n];if(-1!==h.indexOf(n)||"parent_id"===n)throw new Error("Cannot use additional (custom) param named "+n);g[n]=o}}this.__super__.ignoreNextNew=!0,this.__super__.__sendWithCallback(f,g,"data",d,e)},u.get=function(a,b,c,d){var e;this.__super__.__checkProjectId(a);var f="data.get",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),j(c)){var h=["dataIds","folders","byUser","parentIds"];for(e=0;e<h.length;e++){var o=h[e];j(c[o])&&(g[i(o)]=c[o])}var p=["maxId","limit","sinceId","depth","childrenLimit"];for(e=0;e<p.length;e++){var q=p[e];if(j(c[q])){if(!k(c[q]))throw new Error(q+" must be a number");g[i(q)]=c[q]}}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");g.state=c.state}if(j(c.sinceTime)){if(!l(c.sinceTime))throw new Error("Param sinceTime must be a proper date string");g.since_time=c.sinceTime}if(j(c.order)){if(-1===["asc","desc"].indexOf(c.order.toLowerCase()))throw new Error('incorrect value of order param - only "asc" and "desc" are allowed');g.order=c.order}if(j(c.orderBy)){if(!m(c.orderBy.toLowerCase(),["created_at","updated_at"]))throw new Error('incorrect value of order_by param - only "created_at" and "updated_at" are allowed');g.order_by=c.orderBy}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');g.filter=c.filter}if(j(c.includeChildren)){if(!n(c.includeChildren))throw new Error("includeChildren param must be boolean");g.include_children=c.includeChildren}}this.__super__.__sendWithCallback(f,g,"data",d)},u.getOne=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.get_one",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),"string"==typeof c)f.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");f.data_id=c}this.__super__.__sendWithCallback(e,f,"data",d)},u.update=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.update",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),"string"==typeof c)g.data_key=c;else{if("number"!=typeof c)throw new Error("Data key/id must be passed");g.data_id=c}if(j(d)){for(var h=["updateMethod","userName","sourceUrl","title","text","link","image","imageUrl","dataKey"],l=0;l<h.length;l++){var n=h[l];j(d[n])&&(g[i(n)]=d[n])}if(j(d.parentId)){if(!k(d.parentId))throw new Error("parentId must be a number");g.parent_id=d.parentId}if(j(d.state)){if(!m(d.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");g.state=d.state}}if(j(d.additional))for(var o in d.additional)if(d.additional.hasOwnProperty(o)){var p=d.additional[o];if("undefined"!=typeof g[o])throw new Error("Cannot use additional (custom) param named "+o);g[o]=p}this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(f,g,"data",e)},u.move=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.move",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataIds","folders","byUser","newFolder"],h=0;h<g.length;h++){var l=g[h];j(c[l])&&(f[i(l)]=c[l])}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.newState)){if(!m(c.newState.toLowerCase(),["pending","moderated","rejected"]))throw new Error("incorrect value of newState param");f.new_state=c.newState}if(j(c.limit)){if(!k(c.limit))throw new Error("limit must be a number");f.limit=c.limit}}this.__super__.ignoreNextChange=!0,this.__super__.__sendWithCallback(e,f,null,d)},u.copy=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.copy",f={project_id:a,data_ids:[]};if(f=this.__super__.__addCollectionIdentifier(f,b),!j(c))throw new Error("dataId must be set");if(k(c))f.data_ids=[String(c)];else{if("object"!=typeof c)throw new Error("dataId must be integer or array of integers");f.data_ids=[];for(var g=0;g<c.length;g++){if(!k(c[g]))throw new Error("dataId must be integer or array of integers");f.data_ids.push(String(c[g]))}}this.__super__.__sendWithCallback(e,f,"data",d)},u.addParent=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_parent",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("parentId must be passed");h.parent_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.ignoreNextNewRelation=!0,this.__super__.__sendWithCallback(g,h,null,f)},u.removeParent=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_parent",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.parent_id=d),this.__super__.ignoreNextDeleteRelation=!0,this.__super__.__sendWithCallback(f,g,null,e)},u.addChild=function(a,b,c,d,e,f){this.__super__.__checkProjectId(a);var g="data.add_child",h={project_id:a};if(h=this.__super__.__addCollectionIdentifier(h,b),!j(c)||!k(c))throw new Error("dataId must be passed");if(h.data_id=c,!j(d)||!k(d))throw new Error("childId must be passed");h.child_id=d,j(e)&&n(e)&&(h.remove_other=e),this.__super__.ignoreNextNewRelation=!0,this.__super__.__sendWithCallback(g,h,null,f)},u.removeChild=function(a,b,c,d,e){this.__super__.__checkProjectId(a);var f="data.remove_child",g={project_id:a};if(g=this.__super__.__addCollectionIdentifier(g,b),!j(c)||!k(c))throw new Error("dataId must be passed");g.data_id=c,j(d)&&k(d)&&(g.child_id=d),this.__super__.ignoreNextDeleteRelation=!0,this.__super__.__sendWithCallback(f,g,null,e)},u.delete=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.delete",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["dataIds","folders","byUser"],h=0;h<g.length;h++){var l=g[h];j(c[l])&&(f[i(l)]=c[l])}if(j(c.limit)){if(!k(c.limit))throw new Error("limit must be a number");f.limit=c.limit}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.ignoreNextDelete=!0,this.__super__.__sendWithCallback(e,f,null,d)},u.count=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="data.count",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){for(var g=["folders","byUser"],h=0;h<g.length;h++){var k=g[h];j(c[k])&&(f[i(k)]=c[k])}if(j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"count",d)};var v={};v.__internalDataGet=function(a,b,c,d,e,f){this.__super__.Data.get(c,d,e,function(g){var h=g.length;a=a.concat(g),0===h||h!==b?f(a):(e.sinceId=g[h-1].id,this.__internalDataGet(a,b,c,d,e,f))}.bind(this))},v.get=function(a,b,c,d){var e=[],f=100;"undefined"!=typeof c.limit&&(f=c.limit),this.__internalDataGet(e,f,a,b,c,function(a){d(a)})};var w={};w.__internalReadLevel=function(a,b,c,d,e){this.__super__.BigData.get(a,b,c,function(f){for(var g=f.length,h=[],i=0;g>i;i++){var j=f[i],k=0|j.id;d.push(k),j.children_count>0&&h.push(k)}h.length>0?(c.parentIds=h,this.__internalReadLevel(a,b,c,d,e)):e(d)}.bind(this))},w.__internalRemoveIds=function(a,b,c,d,e){var f=100,g=c.splice(0,f),h={dataIds:g,folders:d};this.__super__.Data.delete(a,b,h,function(){0===c.length?e():this.__internalRemoveIds(a,b,c,d,e)}.bind(this))},w.delete=function(a,b,c,d,e){var f={parentIds:c,folders:d,includeChildren:!1},g=[c];this.__internalReadLevel(a,b,f,g,function(c){this.__internalRemoveIds(a,b,c,d,e)}.bind(this))};var x={};x.login=function(a,b,e,f,g){var h="user.login",i={};if("object"===c(a)&&d(b)){var k=a;g=b,f=k.api_key,a=k.user_name,b=k.password,e=k.instance}if(!j(a))throw new Error("Please provide user name");if(i.user_name=a,!j(b))throw new Error("Please provide password");i.password=b,j(e)&&(i.instance=e),j(f)&&(i.apiKey=f),this.__super__.__sendAjaxRequest(h,i,"user",function(a){"undefined"!=typeof a.auth_key?(this.auth_key=a.auth_key,"function"==typeof g&&g(a)):"function"==typeof g&&g(a)}.bind(this.__super__))},x.new=function(a,b,c){var d="user.new",e={};if(!j(a))throw new Error("user must have a name");e.user_name=a,j(b)&&(e.nick=b),this.__super__.__sendWithCallback(d,e,"user",c)},x.getAll=function(a,c,d){var e="user.get_all";"function"==typeof arguments[0]&&(d=arguments[0],a=b,c=b);var f={};if(j(a)){if(!k(a))throw new Error("sinceId must be a number");f.since_id=a}if(j(c)){if(!k(c))throw new Error("limit must be a number");f.limit=c}this.__super__.__sendWithCallback(e,f,"user",d)},x.get=function(a,b,c,d){this.__super__.__checkProjectId(a);var e="user.get",f={project_id:a};if(f=this.__super__.__addCollectionIdentifier(f,b),j(c)){if(j(c.folders)&&(f.folders=c.folders),j(c.state)){if(!m(c.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");f.state=c.state}if(j(c.filter)){if(!m(c.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');f.filter=c.filter}}this.__super__.__sendWithCallback(e,f,"user",d)},x.getOne=function(a,b){var c="user.get_one",d={};if(!j(a))throw new Error("user id or name must be passed");if("number"==typeof a)d.user_id=a;else{if("string"!=typeof a)throw new Error("incorrect type of user param");d.user_name=a}this.__super__.__sendWithCallback(c,d,"user",b)},x.update=function(a,b,c){var d="user.update",e={};if(!j(a))throw new Error("user id or name must be passed");if("number"==typeof a)e.user_id=a;else{if("string"!=typeof a)throw new Error("incorrect type of user param");e.user_name=a}if(j(b)){if("string"!=typeof b)throw new Error("nick must be given");e.nick=b}this.__super__.__sendWithCallback(d,e,"user",c)},x.count=function(a,c){var d="user.count",e={};if(1===arguments.length&&(c=arguments[0],a=b),j(a)){if(j(a.projectId)&&k(a.projectId)&&(e.project_id=a.projectId),j(a.collection))if("string"==typeof a.collection)e.collection_key=a.collection;else{if("number"!=typeof a.collection)throw new Error("collection identifier must be a string (key) or number (id)");e.collection_id=a.collection}if(j(a.folders)&&(e.folders=a.folders),j(a.state)){if(!m(a.state.toLowerCase(),["pending","moderated","rejected","all"]))throw new Error("incorrect value of state param");e.state=a.state}if(j(a.filter)){if(!m(a.filter.toLowerCase(),["text","image"]))throw new Error('incorrect value of filter param - only "text" and "image" are allowed');e.filter=a.filter}}this.__super__.__sendWithCallback(d,e,"count",c)},x.delete=function(a,b){var c="user.delete",d={};if("number"==typeof a)d.user_id=a;else{if("string"!=typeof a)throw new Error("user identifier must be given");d.user_name=a}this.__super__.__sendWithCallback(c,d,null,b)};var y={};y.subscribeProject=function(a,b){var c="subscription.subscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},null,b)},y.unsubscribeProject=function(a,b){var c="subscription.unsubscribe_project";if(!j(a)||!k(a))throw new Error("projectId must be defined");this.__super__.__sendWithCallback(c,{project_id:a},null,b)},y.subscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.subscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},y.unsubscribeCollection=function(a,b,c){this.__super__.__checkProjectId(a);var d="subscription.unsubscribe_collection",e={project_id:a};e=this.__super__.__addCollectionIdentifier(e,b),this.__super__.__sendWithCallback(d,e,null,c)},y.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="subscription.get",e={};j(a)&&(e.api_client_id=a),this.__super__.__sendWithCallback(d,e,"subscription",c)};var z={};z.get=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="connection.get",e={};if(j(a)){for(var f=["apiClientId","sinceId","limit"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.name)){if("string"!=typeof a.name)throw new Error(d+": name must be a string");e.name=a.name}}this.__super__.__sendWithCallback(d,e,"connection",c)},z.update=function(a,c,d){"function"==typeof arguments[1]&&(d=arguments[1],c=b);var e="connection.update",f={};if(!j(a)||"string"!=typeof a)throw new Error(e+": uuid parameter is required");if(f.uuid=a,j(c)){if(j(c.apiClientId)){if(!k(c.apiClientId))throw new Error(e+": apiClientId must be a number");f.api_client_id=c.apiClientId}if(j(c.name)){if("string"!=typeof c.name)throw new Error(e+": name must be a string");f.name=c.name}if(j(c.state)){if("string"!=typeof c.state)throw new Error(e+": state must be a string");f.state=c.state}}this.__super__.__sendWithCallback(e,f,"connection",d)};var A={};A.send=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.send",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}if(j(a.uuid)){if("string"!=typeof a.uuid)throw new Error(d+": uuid must be a string");e.uuid=a.uuid}if(j(a.data))for(var f in a.data)if(a.data.hasOwnProperty(f)){var g=a.data[f];if(m(f,["apiClientId","api_client_id","uuid"]))throw new Error(d+": Cannot send custom param named "+f);e[f]=g}}this.__super__.__sendWithCallback(d,e,null,c)},A.getHistory=function(a,c){"function"==typeof arguments[0]&&(c=arguments[0],a=b);var d="notification.get_history",e={};if(j(a)){if(j(a.apiClientId)){if(!k(a.apiClientId))throw new Error(d+": apiClientId must be a number");e.api_client_id=a.apiClientId}for(var f=["limit","sinceId"],g=0;g<f.length;g++){var h=f[g];if(j(a[h])){if(!k(a[h]))throw new Error(d+": "+h+" must be a number");e[i(h)]=a[h]}}if(j(a.sinceTime)){if(!l(a.sinceTime))throw new Error(d+": sinceTime must be a proper date string");e.since_time=a.sinceTime}if(j(a.order)){if("undefined"==typeof a.order.toLowerCase||!m(a.order.toLowerCase(),["asc","desc"]))throw new Error(d+': incorrect value of order param - only "asc" and "desc" are allowed');e.order=a.order}}this.__super__.__sendWithCallback(d,e,"history",c)};var B={DISCONNECTED:1,CONNECTED:2,AUTHORIZED:3},C=function(){this.socketURL="https://api.syncano.com/ws",this.socket=null,this.status=B.DISCONNECTED,this.requestId=1,this.uuid=null,this.instance=null,this.apiKey=null,this.requestInProgress=!1,this.ignoreNextNew=!1,this.ignoreNextNewRelation=!1,this.ignoreNextDelete=!1,this.ignoreNextDeleteRelation=!1,this.ignoreNextChange=!1,this.VERSION="3.1.0beta",this.requestsQueue=[],this.connectionType="socket",this.waitingForResponse={},this.Project=r,this.Project.__super__=this,this.Collection=s,this.Collection.__super__=this,this.Folder=t,this.Folder.__super__=this,this.Data=u,this.Data.__super__=this,this.BigData=v,this.BigData.__super__=this,this.Tree=w,this.Tree.__super__=this,this.User=x,this.User.__super__=this,this.Subscription=y,this.Subscription.__super__=this,this.Connection=z,this.Connection.__super__=this,this.Notification=A,this.Notification.__super__=this};C.prototype=h(C.prototype,o),C.prototype.connect=function(b,c){if("undefined"==typeof b||"undefined"==typeof b.api_key||"undefined"==typeof b.instance)throw new Error("syncano.connect requires instance name and api_key");return this.instance=b.instance,this.apiKey=b.api_key,"undefined"==typeof a.SockJS&&(this.connectionType="ajax"),"undefined"!=typeof b.type&&(this.connectionType=b.type),this.connectionParams=b,this.auth_key&&(this.connectionParams.auth_key=this.auth_key),this.status!=B.DISCONNECTED?void(this.reconnectOnSocketClose=!0):("function"==typeof c&&(this.waitingForResponse.auth=["auth",c]),void("socket"===this.connectionType?(this.socket=new a.SockJS(this.socketURL),this.socket.onopen=this.onSocketOpen.bind(this),this.socket.onclose=this.onSocketClose.bind(this),this.socket.onmessage=this.onMessage.bind(this)):"function"==typeof c&&c()))},C.prototype.onSocketOpen=function(){this.status=B.CONNECTED,this.socketSend(this.connectionParams)},C.prototype.onSocketClose=function(){this.status=B.DISCONNECTED,this.socket=null,this.reconnectOnSocketClose===!0&&(this.reconnectOnSocketClose=!1,this.connect(this.connectionParams))},C.prototype.onMessage=function(a){var b=JSON.parse(a.data);if("NOK"===b.result)return this.trigger("syncano:error",b.error||b.data.error),void("auth"===b.type?(this.socket.close(),this.trigger("syncano:auth:error")):(this.requestInProgress=!1,this.sendQueue()));switch(b.type){case"auth":this.parseAuthorizationResponse(b);break;case"callresponse":this.status===B.AUTHORIZED&&(this.requestInProgress=!1,this.sendQueue()),this.parseCallResponse(b);break;case"message":this.parseMessageNotifier(b);break;case"new":"data"===b.object?this.parseNewRecordNotifier(b):"datarelation"===b.object&&this.parseNewRelationNotifier(b);break;case"change":this.parseChangeRecordNotifier(b);break;case"delete":"data"===b.object?this.parseDeleteRecordNotifier(b):this.parseDeleteRelationNotifier(b)}},C.prototype.parseAuthorizationResponse=function(a){this.uuid=a.uuid,this.status=B.AUTHORIZED,this.trigger("syncano:received",a),this.trigger("syncano:authorized",this.uuid),this.parseCallResponse({message_id:"auth",data:a}),this.sendQueue()},C.prototype.parseNewRecordNotifier=function(a){if(this.ignoreNextNew===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextNew=!1);this.trigger("syncano:received",a);var b=0|a.channel.project_id,c=0|a.channel.collection_id,d=a.data,e=d.folder;e&&this.trigger("syncano:newdata:folder-"+e,d),this.trigger("syncano:newdata:project-"+b,d),this.trigger("syncano:newdata:collection-"+c,d)},C.prototype.parseNewRelationNotifier=function(a){if(this.ignoreNextNewRelation===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextNewRelation=!1);if(this.trigger("syncano:received",a),"undefined"!=typeof a.target){var b=a.target.parent_id,c=a.target.child_id;this.trigger("syncano:newparent:data-"+c,b),this.trigger("syncano:newchild:data-"+b,c)}},C.prototype.parseChangeRecordNotifier=function(a){if(this.ignoreNextChange===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextChange=!1);var b=a.target.id;this.trigger("syncano:received",a);for(var c=0;c<b.length;c++){var d=b[c],e={};"undefined"!=typeof a.add&&(e.add=a.add),"undefined"!=typeof a.replace&&(e.replace=a.replace),"undefined"!=typeof a.delete&&(e["delete"]=a["delete"]),this.trigger("syncano:change:data-"+d,e)}},C.prototype.parseDeleteRecordNotifier=function(a){if(this.ignoreNextDelete===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextDelete=!1);var b=a.target.id;this.trigger("syncano:received",a);for(var c=0;c<b.length;c++){var d=b[c];this.trigger("syncano:delete:data-"+d)}},C.prototype.parseDeleteRelationNotifier=function(a){if(this.ignoreNextDeleteRelation===!0)return this.trigger("syncano:ignored",a),void(this.ignoreNextDeleteRelation=!1);if(this.trigger("syncano:received",a),"undefined"!=typeof a.target){var b=a.target.parent_id,c=a.target.child_id;this.trigger("syncano:removeparent:data-"+c,b),this.trigger("syncano:removechild:data-"+b,c)}},C.prototype.parseMessageNotifier=function(a){this.trigger("syncano:received",a),this.trigger("syncano:message",a)},C.prototype.parseCallResponse=function(a){var b=a.message_id;if("undefined"!=typeof b&&"undefined"!=typeof this.waitingForResponse[b]){var c=this.waitingForResponse[b],d=c[0].replace(".",":"),e=c[1];this.trigger("syncano:received",a),this.trigger("syncano:"+d,a.data),"function"==typeof e&&e(a.data),delete this.waitingForResponse[b]}else this.trigger("syncano:ignored",a)},C.prototype.sendQueue=function(){if(this.requestsQueue.length>0){var a=this.requestsQueue.shift();this.socketSend(a)}},C.prototype.getNextRequestId=function(){return this.requestId++},C.prototype.socketSend=function(a){this.socket.send(JSON.stringify(a)+"\n")},C.prototype.sendRequest=function(a,b,c,d){if("undefined"==typeof b&&(b={}),"ajax"===this.connectionType||"ajax"===d){var e="https://"+this.instance+".syncano.com/api/"+a+"?api_key="+this.apiKey+"&";for(var f in b)b.hasOwnProperty(f)&&(e+=f+"="+b[f]+"&");var g=new XMLHttpRequest;g.open("GET",e,!0),g.onreadystatechange=function(){if(4==g.readyState&&200===g.status){var a=JSON.parse(g.responseText);this.trigger("syncano:received",a),c(a)}}.bind(this),g.send()}else if("socket"===this.connectionType){var h={type:"call",method:a,params:b};h.message_id=this.getNextRequestId(),this.waitingForResponse[h.message_id]=[a,c],this.status==B.AUTHORIZED&&this.requestInProgress===!1?(this.requestInProgress=!0,this.trigger("syncano:call",h),this.socketSend(h)):(this.trigger("syncano:queued",h),this.requestsQueue.push(h))}},C.prototype.__checkProjectId=function(a){if("number"!=typeof a)throw new Error("projectId must be a number")},C.prototype.__addCollectionIdentifier=function(a,b){if("number"==typeof b)a.collection_id=b;else{if("string"!=typeof b)throw new Error("Collection key/id must be passed");a.collection_key=b}return a},C.prototype.__sendWithCallback=function(a,b,c,d,e){this.sendRequest(a,b,function(a){var b;
b=null===c?!0:"undefined"!=typeof a[c]?a[c]:a,"function"==typeof d&&d(b)},e)},C.prototype.__sendAjaxRequest=function(a,b,c,d){if("undefined"==typeof b&&(b={}),null===this.instance){if("undefined"==typeof b.instance)throw new Error("Please provide instance name");this.instance=b.instance,delete b.instance}if(null===this.apiKey){if("undefined"==typeof b.apiKey)throw new Error("Please provide api key");this.apiKey=b.apiKey,delete b.apiKey}var e="https://"+this.instance+".syncano.com/api/"+a+"?api_key="+this.apiKey+"&";for(var f in b)b.hasOwnProperty(f)&&(e+=f+"="+b[f]+"&");var g=new XMLHttpRequest;g.open("GET",e,!0),g.onreadystatechange=function(){if(4==g.readyState&&200===g.status){var a,b=JSON.parse(g.responseText);a="undefined"!=typeof b[c]?b[c]:b,this.trigger("syncano:received",b),d(a)}}.bind(this),g.send()};var D=null;a.SyncanoConnector={getInstance:function(){return null===D&&(D=new C),D}}}(this);